<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>የአማርኛ ንባብ ትምህርት - BrightMinds</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        :root {
            --primary: #4a6fa5;
            --secondary: #ff9f1c;
            --accent: #2ec4b6;
            --light: #fdfffc;
            --dark: #011627;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .student-info {
            position: absolute;
            right: 1rem;
            top: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .student-name {
            font-weight: bold;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
        }
        
        .back-home {
            background-color: var(--secondary);
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }
        
        .back-home:hover {
            background-color: #e68a00;
            transform: translateY(-2px);
        }
        
        .progress-container {
            width: 100%;
            background: #e9ecef;
            border-radius: 10px;
            margin: 1rem 0;
            position: relative;
        }
        
        .progress-bar {
            height: 10px;
            background: var(--accent);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s;
        }
        
        .progress-text {
            position: absolute;
            right: 0;
            top: -25px;
            font-size: 0.9rem;
            color: white;
        }
        
        .lesson-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 1rem;
        }
        
        .lesson-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .section-title {
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            margin: 1.5rem 0;
            border-radius: 10px;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .interactive-exercise {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1.5rem 0;
        }
        
        .exercise-title {
            color: var(--secondary);
            margin-bottom: 1rem;
        }
        
        .fidel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .letter-card {
            background-color: var(--accent);
            color: white;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 1.5rem;
        }
        
        .letter-card:hover {
            transform: scale(1.05);
        }
        
        .audio-play-btn {
            padding: 0.5rem 1rem;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .audio-play-btn:hover {
            background-color: #3a5a8a;
        }
        
        .quiz-question {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: #f0f5ff;
            border-radius: 10px;
        }
        
        .answer-feedback {
            margin-top: 0.5rem;
            font-weight: bold;
            display: none;
        }
        
        .correct {
            color: green;
        }
        
        .incorrect {
            color: red;
        }
        
        button {
            padding: 0.6rem 1.2rem;
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 0.5rem;
        }
        
        button:hover {
            background-color: #e68a00;
            transform: translateY(-2px);
        }
        
        .quiz-results {
            background: var(--primary);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            text-align: center;
            display: none;
        }
        
        .fun-fact-card {
            background: rgba(46, 196, 182, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid var(--accent);
        }
        
        .multiple-choice {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .choice-btn {
            background: white;
            border: 2px solid #4a6fa5;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
            color: #333;
        }
        
        .choice-btn:hover {
            background: #e6f0ff;
            transform: scale(1.02);
        }
        
        .choice-btn.selected {
            background: #4a6fa5;
            color: white;
            border-color: #4a6fa5;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .choice-btn.correct-answer {
            background: #2ec4b6;
            color: white;
            border-color: #2ec4b6;
        }
        
        .choice-btn.incorrect-answer {
            background: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
        }
        
        .choice-btn.locked {
            pointer-events: none;
            cursor: not-allowed;
        }
        
        .emoji-feedback {
            font-size: 2rem;
            margin: 0.5rem 0;
            display: none;
        }
        
        #submit-final-quiz {
            background-color: #4a6fa5;
            font-size: 18px;
            padding: 10px 20px;
        }
        
        #submit-final-quiz:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .sentence-practice {
            background: rgba(74, 111, 165, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
          /* New styles for dynamic quiz */
        .big-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .big-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            background-color: #e68a00;
        }
        
        .big-button:disabled {
            background-color: #cccccc;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .lesson-container {
                padding: 0.5rem;
            }
            
            .lesson-section {
                padding: 1rem;
            }
            
            .fidel-grid {
                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            }
            
            .letter-card {
                padding: 0.5rem;
            }
            
            .student-info {
                position: static;
                margin-top: 1rem;
                justify-content: center;
            }
            
            header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-brain"></i>
            <h1>BrightMinds የአማርኛ ንባብ</h1>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="lesson-progress"></div>
            <div class="progress-text" id="progress-percentage">0%</div>
        </div>
        <div class="student-info">
            <div class="student-name" id="student-name-display">ተማሪ</div>
            <a href="../index.html" class="back-home">
                <i class="fas fa-home"></i> ወደ መነሻ ተመለስ
            </a>
        </div>
    </header>

    <div class="lesson-container">
        <!-- Section 1: Fidel -->
        <section class="lesson-section" id="fidel">
            <h2 class="section-title"><i class="fas fa-font"></i> ፊደል</h2>
            
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/dWQQeHyIebk?si=TELyf_MTTZ0z11eg" title="YouTube video player" title="የአማርኛ ፊደል" allowfullscreen></iframe>
            </div>
            
            <div class="fun-fact-card">
                <h3><i class="fas fa-lightbulb" style="color: var(--secondary);"></i> የሚያስደስት እውነታ</h3>
                <p>የአማርኛ ፊደል 33 መሠረታዊ ፊደላት አሉት። እያንዳንዱ ፊደል 7 የተለያዩ ድምፆችን ሊያሳይ ይችላል!</p>
            </div>
            
            <div class="interactive-exercise">
                <h3 class="exercise-title">ፊደላት ሀ - ፐ</h3>
                <div class="fidel-grid" id="fidel-grid"></div>
                
                <div class="quiz-question">
                    <p>የተደረገውን ድምፅ ያዳምጡ እና ትክክለኛውን ፊደል ይምረጡ።</p>
                    <button onclick="playFidelAudio()" class="audio-play-btn">
                        <i class="fas fa-volume-up"></i> ድምጥ ለመስማት
                    </button>
                    <div class="multiple-choice">
                        <button class="choice-btn" onclick="selectFidelAnswer(this, 'ሀ')">ሀ</button>
                        <button class="choice-btn" onclick="selectFidelAnswer(this, 'ለ')">ለ</button>
                        <button class="choice-btn" onclick="selectFidelAnswer(this, 'ሐ')">ሐ</button>
                        <button class="choice-btn" onclick="selectFidelAnswer(this, 'መ')">መ</button>
                    </div>
                    <button onclick="checkFidelAnswer()">መልሱን ያረጋግጡ</button>
                    <div class="answer-feedback" id="fidel-feedback"></div>
                </div>
            </div>
        </section>

        <!-- Section 2: Building Words -->
        <section class="lesson-section" id="words">
            <h2 class="section-title"><i class="fas fa-spell-check"></i> ቃላት መገንባት</h2>
            
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/neIEuD1o_sw?si=C3cWfkhTrKEZAmg4" title="YouTube video player"title="የአማርኛ ቃላት" allowfullscreen></iframe>
            </div>
            
            <div class="fun-fact-card">
                <h3><i class="fas fa-lightbulb" style="color: var(--secondary);"></i> የሚያስደስት እውነታ</h3>
                <p>"እኔ" በአማርኛ ውስጥ አጭር የሆነ ሙሉ ሀረግ ነው!</p>
            </div>
            
            <div class="interactive-exercise">
                <h3 class="exercise-title">የቃላት ልምምድ</h3>
                <div id="word-display" style="font-size: 2rem; text-align: center; margin: 1rem 0;">ቤ ት</div>
                <button onclick="playWordAudio()" class="audio-play-btn">
                    <i class="fas fa-volume-up"></i> ቃሉን ለመስማት
                </button>
                
                <div class="quiz-question">
                    <p>ምን �ዓይነት ቃል ሰምተዋል?</p>
                    <div class="multiple-choice">
                        <button class="choice-btn" onclick="selectWordAnswer(this, 'ቤት')">ቤት</button>
                        <button class="choice-btn" onclick="selectWordAnswer(this, 'ውሃ')">ውሃ</button>
                        <button class="choice-btn" onclick="selectWordAnswer(this, 'እግር')">እግር</button>
                        <button class="choice-btn" onclick="selectWordAnswer(this, 'ፊት')">ፊት</button>
                    </div>
                    <button onclick="checkWordAnswer()">መልሱን ያረጋግጡ</button>
                    <div class="answer-feedback" id="word-feedback"></div>
                </div>
            </div>
        </section>

        <!-- Section 3: Simple Sentences -->
        <section class="lesson-section" id="sentences">
            <h2 class="section-title"><i class="fas fa-align-left"></i> ቀላል ሀረጎች እና ዐረፍተ ነገሮች</h2>
            
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/8F_x1NxEG_I?si=GjINrWCfxobW1_y0" title="YouTube video player" title="የአማርኛ ሀረጎች እና ዐረፍተ ነገሮች" allowfullscreen></iframe>
            </div>
            
            <div class="fun-fact-card">
                <h3><i class="fas fa-lightbulb" style="color: var(--secondary);"></i> የሚያስደስት እውነታ</h3>
                <p>ሙሉ ሀረግ ለመሆን ቢያንስ ርዕሰ ጉዳይ እና ግስ ያስፈልገዋል!</p>
            </div>
            
            <div class="interactive-exercise">
                <h3 class="exercise-title">የሀረግ �ልምምድ</h3>
                
                <div class="sentence-practice">
                    <p id="sentence-display" style="font-size: 1.5rem; text-align: center;">እኔ ቤት እሄዳለሁ።</p>
                    <button onclick="playSentenceAudio()" class="audio-play-btn">
                        <i class="fas fa-volume-up"></i> ሀረጉን ለመስማት
                    </button>
                </div>
                
                <div class="quiz-question">
                    <p>ምን ዓይነት ሀረግ ሰምተዋል?</p>
                    <div class="multiple-choice">
                        <button class="choice-btn" onclick="selectSentenceAnswer(this, 'እኔ ቤት እሄዳለሁ።')">እኔ ቤት እሄዳለሁ።</button>
                        <button class="choice-btn" onclick="selectSentenceAnswer(this, 'ልጁ ውሃ ጠጣ።')">ልጁ ውሃ ጠጣ።</button>
                        <button class="choice-btn" onclick="selectSentenceAnswer(this, 'እኛ እንግዳ እንወዳለን።')">እኛ እንግዳ እንወዳለን።</button>
                        <button class="choice-btn" onclick="selectSentenceAnswer(this, 'እሷ መጽሐፍ አነበበች።')">እሷ መጽሐፍ አነበበች።</button>
                    </div>
                    <button onclick="checkSentenceAnswer()">መልሱን ያረጋግጡ</button>
                    <div class="answer-feedback" id="sentence-feedback"></div>
                </div>
            </div>
        </section>

        <!-- Section 4: Final Reading Quiz -->
        <section class="lesson-section" id="final-quiz">
            <h2 class="section-title"><i class="fas fa-trophy"></i> የንባብ ፈተና</h2>
            
            <div class="interactive-exercise">
                <h3 class="exercise-title">የመጨረሻ ፈተና</h3>
                
                <div class="quiz-question">
                    <p>1. የ "ሳ" ድምፅ የሚያሳይ ፊደል የቱ ነው?</p>
                    <div class="multiple-choice" id="final1-choices">
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final1', 'ሰ')">ሀ) ሰ</button>
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final1', 'ሸ')">ለ) ሸ</button>
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final1', 'ቀ')">ሐ) ቀ</button>
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final1', 'ጸ')">መ) ጸ</button>
                    </div>
                    <div class="answer-feedback" id="final1-feedback"></div>
                </div>
                
                <div class="quiz-question">
                    <p>2. ይህ ቃል ምንድን ነው? ቤ-ት</p>
                    <div class="multiple-choice" id="final2-choices">
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final2', 'ቤት')">ሀ) ቤት</button>
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final2', 'በት')">ለ) በት</button>
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final2', 'በቶ')">ሐ) በቶ</button>
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final2', 'በቱ')">መ) በቱ</button>
                    </div>
                    <div class="answer-feedback" id="final2-feedback"></div>
                </div>
                
                <div class="quiz-question">
                    <p>3. ይህንን ሀረግ ይጨርሱ: "ልጁ መጽሐፍ ___።"</p>
                    <div class="multiple-choice" id="final3-choices">
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final3', 'አነበበ')">ሀ) አነበበ</button>
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final3', 'አየ')">ለ) አየ</button>
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final3', 'ጻፈ')">ሐ) ጻፈ</button>
                        <button class="choice-btn quiz-choice" onclick="selectFinalAnswer(this, 'final3', 'ወሰደ')">መ) ወሰደ</button>
                    </div>
                    <div class="answer-feedback" id="final3-feedback"></div>
                </div>
                
                <button onclick="checkFinalReadingQuiz()" id="submit-final-quiz">ፈተናውን አስረክብ</button>
                <div class="quiz-results" id="final-results"></div>
            </div>
        </section>
          <section class="lesson-section">
            <h2 class="section-title"><i class="fas fa-graduation-cap"></i> Final Assessment</h2>
            <div class="interactive-exercise" style="text-align: center;">
                <button id="load-final-quiz" class="big-button">
                    <i class="fas fa-star"></i> Take Final Amharic Quiz
                </button>
                <div id="dynamic-quiz-container"></div>
            </div>
        </section>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCdBKJRf3txDt8LQLgKvL9UNUWV7iHw6Bk",
            authDomain: "brightminds-learninghub.firebaseapp.com",
            projectId: "brightminds-learninghub",
            storageBucket: "brightminds-learninghub.appspot.com",
            messagingSenderId: "598495988704",
            appId: "1:598495988704:web:5775a73d65e7380fafb985",
            measurementId: "G-2Z74X8ZVVJ"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Global variables
        let currentUser = null;
        let studentData = null;
        let amharicProgress = 0;
        
        // Track progress and selected answers
        const completedSections = new Set();
        let quizScore = 0;
        const selectedAnswers = {
            fidel: null,
            word: null,
            sentence: null,
            final1: null,
            final2: null,
            final3: null
        };
        let finalQuizSubmitted = false;
        
        // Fidel data (first row of Ethiopian alphabet)
        const fidel = [
            "ሀ", "ለ", "ሐ", "መ", "ሠ", "ረ", "ሰ", "ሸ", "ቀ", "በ", "ተ", "ቸ", 
            "ኀ", "ነ", "ኘ", "አ", "ከ", "ኸ", "ወ", "ዐ", "ዘ", "ዠ", "የ", "ደ", 
            "ጀ", "ገ", "ጠ", "ጨ", "ጰ", "ጸ", "ፀ", "ፈ", "ፐ"
        ];
        
        // Current practice items (now static)
        let currentFidel = "ሀ";
        let currentWord = "ቤት";
        let currentSentence = "እኔ ቤት እሄዳለሁ።";
        
        // Load Amharic progress from Firestore
        function loadAmharicProgress() {
            if (!currentUser) return;
            
            db.collection('progress')
                .where('userId', '==', currentUser.uid)
                .where('subject', '==', 'amharic')
                .get()
                .then((querySnapshot) => {
                    if (!querySnapshot.empty) {
                        querySnapshot.forEach((doc) => {
                            const progressData = doc.data();
                            amharicProgress = progressData.progress || 0;
                            
                            // Mark completed sections based on progress
                            if (amharicProgress >= 25) completedSections.add('fidel');
                            if (amharicProgress >= 50) completedSections.add('words');
                            if (amharicProgress >= 75) completedSections.add('sentences');
                            if (amharicProgress >= 100) completedSections.add('final-quiz');
                            
                            updateProgress();
                        });
                    }else{
                        createProgressDocument();
                    }
                })
                .catch((error) => {
                    console.error('Error loading progress:', error);
                });
        }
        
        
// Create a new progress document
        function createProgressDocument() {
            if (!currentUser) return;
            
              // Save to Firestore
               db.collection('progress').add({
                    userId: currentUser.uid,
                    subject: 'amharic',
                    progress: amharicProgress,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    studentName: studentData.firstName && studentData.lastName ? 
                        `${studentData.firstName} ${studentData.lastName}` : 
                        studentData.firstName || studentData.lastName || 'Unknown'
                })
            .then((docRef) => {
                progressDocId = docRef.id;
                console.log('Progress document created with ID: ', progressDocId);
            })
            .catch((error) => {
                console.error('Error creating progress document:', error);
            });
        }
         // Save Math progress to Firestore
        function saveAmharicProgress() {
            if (!currentUser || !progressDocId) return;
            
            // Calculate progress based on completed sections
            const newProgress = (completedSections.size / 4) * 100;
            
            // Only save if progress has changed
            if (newProgress !== amharicProgress) {
                amharicProgress = newProgress;
                
                // Update the existing progress document
                db.collection('progress').doc(progressDocId).update({
                    progress: amharicProgress,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    console.log('Progress updated successfully');
                })
                .catch((error) => {
                    console.error('Error updating progress:', error);
                });
                
                // Also update the user's Knowledge progress in their profile
                db.collection('users').doc(currentUser.uid).update({
                    amharicProgress: amharicProgress
                })
                .catch((error) => {
                    console.error('Error updating user progress:', error);
                });
            }
        }


        // Update progress bar
        function updateProgress() {
            const progress = (completedSections.size / 4) * 100;
            document.getElementById('lesson-progress').style.width = `${progress}%`;
            document.getElementById('progress-percentage').textContent = `${progress}%`;
            
            // Save progress to Firestore
            saveAmharicProgress();
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    currentUser = user;
                    
                    // Get student data
                    db.collection('users').doc(user.uid).get()
                        .then((doc) => {
                            if (doc.exists) {
                                studentData = doc.data();
                                
                                // Display student name
                                const studentName = studentData.firstName && studentData.lastName ? 
                                    `${studentData.firstName} ${studentData.lastName}` : 
                                    studentData.firstName || studentData.lastName || 'ተማሪ';
                                
                                document.getElementById('student-name-display').textContent = studentName;
                                
                                // Load progress
                                loadAmharicProgress();
                            } else {
                                console.error('No student data found');
                            }
                        })
                        .catch((error) => {
                            console.error('Error loading student data:', error);
                        });
                } else {
                    // Redirect to login if not authenticated
                    window.location.href = '../index.html';
                }
            });
            
            // Populate fidel grid
            const grid = document.getElementById('fidel-grid');
            fidel.forEach(letter => {
                const card = document.createElement('div');
                card.className = 'letter-card';
                card.textContent = letter;
                card.onclick = function() {
                    currentFidel = letter;
                    playFidelAudio();
                };
                grid.appendChild(card);
            });
            
            updateProgress();
            
            // Add event listener to the Take Final Quiz button
            document.getElementById('load-final-quiz').addEventListener('click', function() {
                // Redirect to quiz.html with amharic subject parameter
                window.location.href = '../quiz.html?subject=amharic';
            });
        });
        
        // Audio functions (you'll need to add your actual audio files)
        function playFidelAudio() {
            const audio = new Audio("fidelaudio/fidel.mp3");
            audio.play().catch(e => console.log("Audio play failed:", e));
        }
        
        function playWordAudio() {
            const audio = new Audio("wordaudio/bet.mp3");
            audio.play().catch(e => console.log("Audio play failed:", e));
        }
        
        function playSentenceAudio() {
            const sentenceFile = currentSentence.replace(/[።\s]/g, '');
            const audio = new Audio("sentenceaudio/senaudio.mp3");
            audio.play().catch(e => console.log("Audio play failed:", e));
        }
        
        // ===== FIDEL PRACTICE =====
        function selectFidelAnswer(button, fidel) {
            const parentDiv = button.parentElement;
            const allButtons = parentDiv.querySelectorAll('.choice-btn');
            allButtons.forEach(btn => {
                btn.classList.remove('selected');
            });
            
            button.classList.add('selected');
            selectedAnswers.fidel = fidel;
        }
        
        function checkFidelAnswer() {
            const feedback = document.getElementById('fidel-feedback');
            
            if (!selectedAnswers.fidel) {
                feedback.textContent = "እባክዎ መልስ ይምረጡ!";
                feedback.className = 'answer-feedback incorrect';
                feedback.style.display = 'block';
                return;
            }
            
            if (selectedAnswers.fidel === currentFidel) {
                feedback.textContent = `ትክክል! ፊደሉ "${currentFidel}" በትክል መረጡት።`;
                feedback.className = 'answer-feedback correct';
                completedSections.add('fidel');
            } else {
                feedback.textContent = `በድጋሚ ይሞክሩ! ትክክለኛው መልስ "${currentFidel}" ነበር።`;
                feedback.className = 'answer-feedback incorrect';
            }
            
            feedback.style.display = 'block';
            updateProgress();
        }
        
        // ===== WORD PRACTICE =====
        function selectWordAnswer(button, word) {
            const parentDiv = button.parentElement;
            const allButtons = parentDiv.querySelectorAll('.choice-btn');
            allButtons.forEach(btn => {
                btn.classList.remove('selected');
            });
            
            button.classList.add('selected');
            selectedAnswers.word = word;
        }
        
        function checkWordAnswer() {
            const feedback = document.getElementById('word-feedback');
            
            if (!selectedAnswers.word) {
                feedback.textContent = "እባክዎ መልስ ይምረጡ!";
                feedback.className = 'answer-feedback incorrect';
            }
            
            if (selectedAnswers.word === currentWord) {
                feedback.textContent = `ትክክል! "${currentWord}" በትክል ነው "${document.getElementById('word-display').textContent}" የሚለው።`;
                feedback.className = 'answer-feedback correct';
                completedSections.add('words');
            } else {
                feedback.textContent = `በድጋሚ ይሞክሩ! ትክክለኛው መልስ "${currentWord}" ነበር።`;
                feedback.className = 'answer-feedback incorrect';
            }
            
            feedback.style.display = 'block';
            updateProgress();
        }
        
        // ===== SENTENCE PRACTICE =====
        function selectSentenceAnswer(button, sentence) {
            const parentDiv = button.parentElement;
            const allButtons = parentDiv.querySelectorAll('.choice-btn');
            allButtons.forEach(btn => {
                btn.classList.remove('selected');
            });
            
            button.classList.add('selected');
            selectedAnswers.sentence = sentence;
        }
        
        function checkSentenceAnswer() {
            const feedback = document.getElementById('sentence-feedback');
            
            if (!selectedAnswers.sentence) {
                feedback.textContent = "እባክዎ መልስ ይምረጡ!";
                feedback.className = 'answer-feedback incorrect';
                feedback.style.display = 'block';
                return;
            }
            
            if (selectedAnswers.sentence === currentSentence) {
                feedback.textContent = "ትክክል! ሀረጉን በትክክል አነበቡት!";
                feedback.className = 'answer-feedback correct';
                completedSections.add('sentences');
            } else {
                feedback.textContent = `በድጋሚ ይሞክሩ! ትክክለኛው ሀረግ "${currentSentence}" ነበር።`;
                feedback.className = 'answer-feedback incorrect';
            }
            
            feedback.style.display = 'block';
            updateProgress();
        }
        
        // ===== FINAL QUIZ =====
        function selectFinalAnswer(button, questionId, answer) {
            const parentDiv = button.parentElement;
            const allButtons = parentDiv.querySelectorAll('.choice-btn');
            allButtons.forEach(btn => {
                btn.classList.remove('selected');
            });
            
            button.classList.add('selected');
            selectedAnswers[questionId] = answer;
        }
        
        function checkFinalReadingQuiz() {
            if (finalQuizSubmitted) return;
            
            finalQuizSubmitted = true;
            let score = 0;
            const answers = [
                { id: 'final1', correct: 'ሰ', feedback: 'ፊደሉ "ሰ" የ "ሳ" ድምፅ ይሰጣል!' },
                { id: 'final2', correct: 'ቤት', feedback: 'ቤ-ት "ቤት" ይሆናል!' },
                { id: 'final3', correct: 'አነበበ', feedback: '"ልጁ መጽሐፍ አነበበ።" ትክክለኛው ሀረግ ነው!' }
            ];
            
            // Disable all choice buttons
            document.querySelectorAll('.quiz-choice').forEach(btn => {
                btn.classList.add('locked');
            });
            
            // Disable submit button
            document.getElementById('submit-final-quiz').disabled = true;
            
            // Check each answer
            answers.forEach(q => {
                const answer = selectedAnswers[q.id];
                const feedback = document.getElementById(`${q.id}-feedback`);
                const choices = document.getElementById(`${q.id}-choices`);
                
                if (answer && answer === q.correct) {
                    feedback.textContent = `ትክክል! ${q.feedback}`;
                    feedback.className = 'answer-feedback correct';
                    score++;
                    
                    // Highlight correct answer
                    choices.querySelectorAll('.choice-btn').forEach(btn => {
                        if (btn.textContent.includes(q.correct)) {
                            btn.classList.add('correct-answer');
                        }
                    });
                } else {
                    feedback.textContent = `ትክክለኛው መልስ ${q.correct} ነበር። ${q.feedback}`;
                    feedback.className = 'answer-feedback incorrect';
                    
                    // Highlight correct and incorrect answers
                    choices.querySelectorAll('.choice-btn').forEach(btn => {
                        if (btn.textContent.includes(q.correct)) {
                            btn.classList.add('correct-answer');
                        }
                        if (btn.classList.contains('selected') && !btn.textContent.includes(q.correct)) {
                            btn.classList.add('incorrect-answer');
                        }
                    });
                }
                feedback.style.display = 'block';
            });
            
            const resultsDiv = document.getElementById('final-results');
            const percentage = Math.round((score / answers.length) * 100);
            
            resultsDiv.innerHTML = `
                <h3>ውጤትዎ: ${score} ከ ${answers.length}</h3>
                <div style="font-size: 3rem; margin: 0.5rem 0;">
                    ${percentage >= 75 ? '🌟🌟🌟🌟🌟' : 
                     percentage >= 50 ? '🌟🌟🌟☆☆' : '🌟🌟☆☆☆'}
                </div>
                ${percentage >= 75 ? 
                 '<p><i class="fas fa-trophy"></i> እንኳን ደስ አለዎት! እጅግ ጥሩ አነበብዎት! <i class="fas fa-trophy"></i></p>' : 
                 percentage >= 50 ? 
                 '<p>ጥሩ አደረጉ! እየተሻሻሉ ነው!</p>' : 
                 '<p>ጥሩ ፈተና ሰጡ! በማለት መለማመድ ይቀጥሉ!</p>'}
                <p style="margin-top: 1rem;"><small>ፈተናው ተላልፏል - መልሶ ማስተካከል አይቻልም</small></p>
            `;
            resultsDiv.style.display = 'block';
            
            if (score === answers.length) {
                completedSections.add('final-quiz');
            }
            updateProgress();
        }
    </script>
</body>
</html>